<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>ZARA | SaÃºde</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      background: #0b0b0b;
      color: #e5e5e5;
      font-family: Inter, system-ui, -apple-system, sans-serif;
      margin: 0;
      padding: 24px;
    }

    h1 {
      font-size: 24px;
      margin-bottom: 8px;
    }

    .card {
      background: #141414;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 24px;
      border: 1px solid #222;
    }

    .hidden {
      display: none;
    }

    label {
      display: block;
      font-size: 12px;
      margin-bottom: 6px;
      color: #aaa;
    }

    input, select, button {
      width: 100%;
      padding: 10px;
      margin-bottom: 12px;
      border-radius: 8px;
      border: 1px solid #333;
      background: #0f0f0f;
      color: #fff;
    }

    button {
      background: #caa86a;
      border: none;
      font-weight: 600;
      cursor: pointer;
    }

    button.secondary {
      background: transparent;
      border: 1px solid #444;
      color: #aaa;
    }

    .telegram-status {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 14px;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #22c55e;
    }

    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    @media (max-width: 600px) {
      .row {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>

  <h1>ðŸ’Š Controle de Medicamentos</h1>

  <!-- =========================
       TELEGRAM CONFIG
       ========================= -->

  <div class="card" id="telegram-config">
    <h2>ðŸ”” NotificaÃ§Ãµes Telegram</h2>

    <label>Bot Token</label>
    <input id="botToken" placeholder="Cole o token do bot" />

    <label>Chat ID</label>
    <input id="chatId" placeholder="Ex: 123456789" />

    <button onclick="testarTelegram()">Testar ConexÃ£o</button>
  </div>

  <!-- STATUS (OCULTO APÃ“S CONECTAR) -->
  <div class="card hidden" id="telegram-status">
    <div class="telegram-status">
      <div class="status-dot"></div>
      Telegram conectado
    </div>
    <br />
    <button class="secondary" onclick="reconfigurarTelegram()">Reconfigurar</button>
  </div>

  <!-- =========================
       MEDICAMENTOS
       ========================= -->

  <div class="card">
    <h2>Adicionar Medicamento</h2>

    <label>Nome</label>
    <input id="medNome" placeholder="Ex: Enantato" />

    <div class="row">
      <div>
        <label>Dose</label>
        <input id="medDose" placeholder="Ex: 250mg" />
      </div>

      <div>
        <label>HorÃ¡rio</label>
        <input id="medHora" type="time" />
      </div>
    </div>

    <button onclick="salvarMedicamento()">Adicionar Medicamento</button>
  </div>

  <script>
    // =========================
    // CONFIG
    // =========================
    const SUPABASE_URL = 'https://SEU_PROJECT_ID.supabase.co'
    const SUPABASE_ANON_KEY = 'SUA_ANON_KEY'

    const userId = 'user-demo' // ajuste se usar auth

    // =========================
    // TELEGRAM
    // =========================
    async function testarTelegram() {
      const botToken = document.getElementById('botToken').value
      const chatId = document.getElementById('chatId').value

      if (!botToken || !chatId) {
        alert('Preencha o token e o chat ID')
        return
      }

      const res = await fetch(`${SUPABASE_URL}/rest/v1/telegram_config`, {
        method: 'POST',
        headers: {
          apikey: SUPABASE_ANON_KEY,
          Authorization: `Bearer ${SUPABASE_ANON_KEY}`,
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          user_id: userId,
          bot_token: botToken,
          chat_id: chatId,
          ativo: true,
        }),
      })

      if (res.ok) {
        ativarStatusTelegram()
      } else {
        alert('Erro ao salvar Telegram')
      }
    }

    function ativarStatusTelegram() {
      document.getElementById('telegram-config').classList.add('hidden')
      document.getElementById('telegram-status').classList.remove('hidden')
    }

    function reconfigurarTelegram() {
      document.getElementById('telegram-config').classList.remove('hidden')
      document.getElementById('telegram-status').classList.add('hidden')
    }

    // =========================
    // MEDICAMENTOS
    // =========================
    async function salvarMedicamento() {
      const nome = document.getElementById('medNome').value
      const dose = document.getElementById('medDose').value
      const hora = document.getElementById('medHora').value

      if (!nome || !dose || !hora) {
        alert('Preencha todos os campos')
        return
      }

      alert('Medicamento salvo (exemplo)')
      // Aqui vocÃª liga com saude_dados se quiser
    }

    // =========================
    // INIT â€” detectar Telegram ativo
    // =========================
    async function init() {
      const res = await fetch(
        `${SUPABASE_URL}/rest/v1/telegram_config?user_id=eq.${userId}&ativo=eq.true`,
        {
          headers: {
            apikey: SUPABASE_ANON_KEY,
            Authorization: `Bearer ${SUPABASE_ANON_KEY}`,
          },
        },
      )

      const data = await res.json()
      if (data.length > 0) {
        ativarStatusTelegram()
      }
    }

    init()
  </script>
</body>
</html>
