<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0a0a0a">
    <meta name="color-scheme" content="dark">
    <title>ZARA | Private Access</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            background: #0a0a0a !important;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #0a0a0a !important;
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(ellipse at center, rgba(120, 90, 60, 0.03) 0%, transparent 50%);
            pointer-events: none;
        }

        .container {
            text-align: center;
            max-width: 480px;
            width: 100%;
            position: relative;
            z-index: 1;
        }

        .logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 30px;
            border: 1px solid rgba(212, 175, 125, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .logo::before {
            content: '';
            position: absolute;
            inset: -1px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(212, 175, 125, 0.5), transparent, rgba(212, 175, 125, 0.2));
            z-index: -1;
        }

        .logo-text {
            font-family: 'Playfair Display', serif;
            font-size: 1.8em;
            color: #d4af7d;
            font-weight: 400;
        }

        h1 {
            font-family: 'Playfair Display', serif;
            color: #fff;
            font-size: 2.2em;
            font-weight: 400;
            letter-spacing: 8px;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .subtitle {
            color: rgba(212, 175, 125, 0.8);
            font-size: 0.7em;
            margin-bottom: 50px;
            font-weight: 300;
            letter-spacing: 4px;
            text-transform: uppercase;
        }

        .divider {
            width: 60px;
            height: 1px;
            background: linear-gradient(90deg, transparent, #d4af7d, transparent);
            margin: 0 auto 50px;
        }

        .menu {
            display: flex;
            flex-direction: column;
            gap: 1px;
            background: rgba(212, 175, 125, 0.1);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid rgba(212, 175, 125, 0.15);
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 22px 25px;
            background: rgba(15, 15, 15, 0.95);
            text-decoration: none;
            color: #fff;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .menu-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 0;
            background: linear-gradient(90deg, rgba(212, 175, 125, 0.1), transparent);
            transition: width 0.4s ease;
        }

        .menu-item:hover::before {
            width: 100%;
        }

        .menu-item:hover {
            background: rgba(20, 20, 20, 0.95);
        }

        .menu-item:hover .icon {
            transform: scale(1.1);
            color: #d4af7d;
        }

        .menu-item:hover .arrow {
            transform: translateX(5px);
            color: #d4af7d;
        }

        .menu-item .icon {
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            transition: all 0.4s ease;
            position: relative;
            z-index: 1;
        }

        .menu-item .icon svg {
            width: 20px;
            height: 20px;
        }

        .menu-item .text {
            text-align: left;
            flex: 1;
            position: relative;
            z-index: 1;
        }

        .menu-item h3 {
            font-size: 0.95em;
            font-weight: 500;
            margin-bottom: 3px;
            letter-spacing: 1px;
        }

        .menu-item p {
            font-size: 0.7em;
            color: rgba(255, 255, 255, 0.4);
            font-weight: 300;
            letter-spacing: 0.5px;
        }

        .menu-item .arrow {
            color: rgba(255, 255, 255, 0.2);
            transition: all 0.4s ease;
            position: relative;
            z-index: 1;
        }

        .menu-item .arrow svg {
            width: 18px;
            height: 18px;
        }

        .footer {
            margin-top: 50px;
            color: rgba(255, 255, 255, 0.2);
            font-size: 0.65em;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            background: linear-gradient(135deg, rgba(212, 175, 125, 0.2), rgba(212, 175, 125, 0.1));
            border: 1px solid rgba(212, 175, 125, 0.3);
            border-radius: 20px;
            font-size: 0.55em;
            color: #d4af7d;
            letter-spacing: 2px;
            margin-bottom: 30px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .badge:hover {
            background: linear-gradient(135deg, rgba(212, 175, 125, 0.3), rgba(212, 175, 125, 0.15));
            transform: scale(1.05);
        }

        .badge.unlocked {
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.2), rgba(46, 204, 113, 0.1));
            border-color: rgba(46, 204, 113, 0.4);
            color: #2ecc71;
        }

        .gold-line {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, #d4af7d, transparent);
        }

        .gold-line-bottom {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, #d4af7d, transparent);
        }

        .content-locked .menu {
            filter: blur(8px);
            pointer-events: none;
            opacity: 0.3;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(10px);
        }

        .modal-overlay.active {
            display: flex;
        }

        .login-modal {
            background: linear-gradient(145deg, #1a1a1a, #0f0f0f);
            border: 1px solid rgba(212, 175, 125, 0.2);
            border-radius: 20px;
            padding: 40px 35px;
            width: 90%;
            max-width: 380px;
            text-align: center;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.6);
            position: relative;
        }

        .login-modal::before {
            content: '';
            position: absolute;
            top: -1px;
            left: 50%;
            transform: translateX(-50%);
            width: 60%;
            height: 1px;
            background: linear-gradient(90deg, transparent, #d4af7d, transparent);
        }

        .login-logo {
            width: 60px;
            height: 60px;
            margin: 0 auto 25px;
            border: 1px solid rgba(212, 175, 125, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Playfair Display', serif;
            font-size: 1.5em;
            color: #d4af7d;
        }

        .login-modal h2 {
            font-family: 'Playfair Display', serif;
            font-size: 1.4em;
            font-weight: 400;
            color: #fff;
            margin-bottom: 8px;
            letter-spacing: 2px;
        }

        .login-modal .login-subtitle {
            font-size: 0.75em;
            color: rgba(255, 255, 255, 0.4);
            margin-bottom: 30px;
            letter-spacing: 1px;
        }

        .login-field {
            margin-bottom: 20px;
            text-align: left;
        }

        .login-field label {
            display: block;
            font-size: 0.7em;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 8px;
        }

        .login-field input {
            width: 100%;
            padding: 14px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(212, 175, 125, 0.2);
            border-radius: 10px;
            color: #fff;
            font-size: 1em;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .login-field input:focus {
            outline: none;
            border-color: #d4af7d;
            background: rgba(255, 255, 255, 0.08);
        }

        .login-field input::placeholder {
            color: rgba(255, 255, 255, 0.3);
        }

        .login-error {
            color: #e74c3c;
            font-size: 0.8em;
            margin-bottom: 15px;
            display: none;
        }

        .login-error.show {
            display: block;
        }

        .login-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #d4af7d, #c9a066);
            border: none;
            border-radius: 10px;
            color: #0a0a0a;
            font-size: 0.9em;
            font-weight: 600;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .login-btn:hover {
            background: linear-gradient(135deg, #e0c08d, #d4af7d);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(212, 175, 125, 0.3);
        }

        .login-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: color 0.3s;
            padding: 5px;
        }

        .login-close:hover {
            color: #d4af7d;
        }

        .login-close svg {
            width: 20px;
            height: 20px;
        }

        /* Botão de Biometria / Face ID */
        .biometric-btn {
            width: 100%;
            padding: 16px;
            background: rgba(212, 175, 125, 0.1);
            border: 1px solid rgba(212, 175, 125, 0.3);
            border-radius: 12px;
            color: #d4af7d;
            font-size: 0.9em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .biometric-btn:hover {
            background: rgba(212, 175, 125, 0.2);
            border-color: rgba(212, 175, 125, 0.5);
            transform: translateY(-2px);
        }

        .biometric-btn:active {
            transform: scale(0.98);
        }

        .biometric-btn svg {
            stroke: #d4af7d;
        }

        .login-divider {
            display: flex;
            align-items: center;
            margin: 20px 0;
            color: rgba(255, 255, 255, 0.3);
            font-size: 0.75em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .login-divider::before,
        .login-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
        }

        .login-divider span {
            padding: 0 15px;
        }

        .setup-biometric-link {
            background: none;
            border: none;
            color: rgba(212, 175, 125, 0.6);
            font-size: 0.75em;
            cursor: pointer;
            margin-top: 20px;
            padding: 10px;
            transition: color 0.3s;
        }

        .setup-biometric-link:hover {
            color: #d4af7d;
        }

        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #1a1a1a;
            border: 1px solid rgba(46, 204, 113, 0.4);
            padding: 14px 28px;
            border-radius: 10px;
            font-size: 0.85em;
            color: #2ecc71;
            z-index: 2000;
            opacity: 0;
            transition: all 0.4s ease;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-10px); }
            40%, 80% { transform: translateX(10px); }
        }

        @media (max-width: 500px) {
            h1 {
                font-size: 1.6em;
                letter-spacing: 5px;
            }

            .menu-item {
                padding: 18px 20px;
                gap: 15px;
            }

            .menu-item .icon {
                width: 40px;
                height: 40px;
            }

            .menu-item h3 {
                font-size: 0.9em;
            }

            .logo {
                width: 65px;
                height: 65px;
            }

            .logo-text {
                font-size: 1.5em;
            }

            .login-modal {
                width: 95%;
                padding: 30px 25px;
            }
        }
    </style>
</head>
<body>
    <div class="gold-line"></div>
    <div class="gold-line-bottom"></div>

    <div class="container content-locked" id="mainContainer">
        <div class="logo">
            <span class="logo-text">Z</span>
        </div>
        
        <span class="badge" id="badgeAccess" onclick="abrirLogin()">Private Access</span>
        
        <h1>Zara</h1>
        <p class="subtitle">Excellence in Control</p>
        
        <div class="divider"></div>

        <nav class="menu">
            <a href="comando.html" class="menu-item">
                <span class="icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                    </svg>
                </span>
                <div class="text">
                    <h3>Comando</h3>
                    <p>Disciplina e Poder</p>
                </div>
                <span class="arrow">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 12h14M12 5l7 7-7 7"/>
                    </svg>
                </span>
            </a>

            <a href="financeiro.html" class="menu-item">
                <span class="icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <line x1="12" y1="1" x2="12" y2="23"/>
                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                    </svg>
                </span>
                <div class="text">
                    <h3>Financeiro</h3>
                    <p>Patrimonio e Investimentos</p>
                </div>
                <span class="arrow">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 12h14M12 5l7 7-7 7"/>
                    </svg>
                </span>
            </a>

            <a href="familiar.html" class="menu-item">
                <span class="icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                    </svg>
                </span>
                <div class="text">
                    <h3>Familiar</h3>
                    <p>Familia e Compromissos</p>
                </div>
                <span class="arrow">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 12h14M12 5l7 7-7 7"/>
                    </svg>
                </span>
            </a>

            <a href="profissional.html" class="menu-item">
                <span class="icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <rect x="2" y="7" width="20" height="14" rx="2" ry="2"/>
                        <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/>
                    </svg>
                </span>
                <div class="text">
                    <h3>Profissional</h3>
                    <p>Carreira e Projetos</p>
                </div>
                <span class="arrow">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 12h14M12 5l7 7-7 7"/>
                    </svg>
                </span>
            </a>

            <a href="saude.html" class="menu-item">
                <span class="icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                    </svg>
                </span>
                <div class="text">
                    <h3>Saude</h3>
                    <p>Bem-estar e Vitalidade</p>
                </div>
                <span class="arrow">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 12h14M12 5l7 7-7 7"/>
                    </svg>
                </span>
            </a>
        </nav>

        <p class="footer">2025 Zara Institute - Members Only</p>
    </div>

    <div class="modal-overlay" id="loginModal">
        <div class="login-modal">
            <button class="login-close" onclick="fecharLogin()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
            </button>
            <div class="login-logo">Z</div>
            <h2>Acesso Privado</h2>
            <p class="login-subtitle">Digite suas credenciais para continuar</p>
            
            <!-- Botão Face ID / Biometria -->
            <button type="button" class="biometric-btn" id="biometricBtn" onclick="autenticarBiometria()" style="display: none;">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" width="32" height="32">
                    <path d="M7 3H5a2 2 0 0 0-2 2v2M17 3h2a2 2 0 0 1 2 2v2M7 21H5a2 2 0 0 1-2-2v-2M17 21h2a2 2 0 0 0 2-2v-2"/>
                    <circle cx="12" cy="12" r="4"/>
                    <path d="M12 8v1M12 15v1M8 12h1M15 12h1"/>
                </svg>
                <span>Usar Face ID</span>
            </button>
            
            <div class="login-divider" id="loginDivider" style="display: none;">
                <span>ou</span>
            </div>
            
            <form onsubmit="verificarLogin(event)">
                <div class="login-field">
                    <label>Usuario</label>
                    <input type="text" id="loginUser" placeholder="Digite seu usuario" autocomplete="off">
                </div>
                <div class="login-field">
                    <label>Senha</label>
                    <input type="password" id="loginPassword" placeholder="Digite sua senha">
                </div>
                <p class="login-error" id="loginError">Credenciais invalidas. Tente novamente.</p>
                <button type="submit" class="login-btn">Entrar</button>
            </form>
            
            <!-- Link para configurar biometria -->
            <button type="button" class="setup-biometric-link" id="setupBiometricLink" onclick="configurarBiometria()" style="display: none;">
                Configurar Face ID / Biometria
            </button>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <!-- Modal de Logout -->
    <div class="modal-overlay" id="logoutModal">
        <div class="login-modal" style="max-width: 350px;">
            <div class="login-logo">Z</div>
            <h2>Encerrar Sessao</h2>
            <p class="login-subtitle">Voce ja esta autenticado. Deseja sair?</p>
            <div style="display: flex; gap: 10px; margin-top: 25px;">
                <button onclick="fecharLogout()" style="flex:1; padding: 14px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 10px; color: #fff; font-size: 0.9em; cursor: pointer; transition: all 0.3s;">Cancelar</button>
                <button onclick="confirmarLogout()" style="flex:1; padding: 14px; background: linear-gradient(135deg, #d4af7d, #c9a066); border: none; border-radius: 10px; color: #0a0a0a; font-size: 0.9em; font-weight: 600; cursor: pointer; transition: all 0.3s;">Sair</button>
            </div>
        </div>
    </div>

    <script>
        var CREDENCIAIS = {
            usuario: 'master',
            senha: '2026'
        };

        var AUTH_KEY = 'zara_authenticated';

        function verificarSessao() {
            var autenticado = sessionStorage.getItem(AUTH_KEY);
            if (autenticado === 'true') {
                desbloquearConteudo();
            }
        }

        function abrirLogin() {
            var autenticado = sessionStorage.getItem(AUTH_KEY);
            if (autenticado === 'true') {
                document.getElementById('logoutModal').classList.add('active');
                return;
            }
            document.getElementById('loginModal').classList.add('active');
            document.getElementById('loginUser').focus();
        }

        function fecharLogout() {
            document.getElementById('logoutModal').classList.remove('active');
        }

        function confirmarLogout() {
            sessionStorage.removeItem(AUTH_KEY);
            bloquearConteudo();
            fecharLogout();
            toast('Sessao encerrada');
        }

        function fecharLogin() {
            document.getElementById('loginModal').classList.remove('active');
            document.getElementById('loginUser').value = '';
            document.getElementById('loginPassword').value = '';
            document.getElementById('loginError').classList.remove('show');
        }

        function verificarLogin(e) {
            e.preventDefault();
            
            var usuario = document.getElementById('loginUser').value.trim().toLowerCase();
            var senha = document.getElementById('loginPassword').value;
            
            if (usuario === CREDENCIAIS.usuario.toLowerCase() && senha === CREDENCIAIS.senha) {
                sessionStorage.setItem(AUTH_KEY, 'true');
                fecharLogin();
                desbloquearConteudo();
                toast('Acesso autorizado');
            } else {
                document.getElementById('loginError').classList.add('show');
                document.getElementById('loginPassword').value = '';
                document.getElementById('loginPassword').focus();
                
                var modal = document.querySelector('.login-modal');
                modal.style.animation = 'shake 0.5s';
                setTimeout(function() { modal.style.animation = ''; }, 500);
            }
        }

        function desbloquearConteudo() {
            document.getElementById('mainContainer').classList.remove('content-locked');
            var badge = document.getElementById('badgeAccess');
            badge.textContent = 'Access Granted';
            badge.classList.add('unlocked');
        }

        function bloquearConteudo() {
            document.getElementById('mainContainer').classList.add('content-locked');
            var badge = document.getElementById('badgeAccess');
            badge.textContent = 'Private Access';
            badge.classList.remove('unlocked');
        }

        function toast(msg) {
            var el = document.getElementById('toast');
            el.textContent = msg;
            el.classList.add('show');
            setTimeout(function() { el.classList.remove('show'); }, 3000);
        }

        document.getElementById('loginModal').addEventListener('click', function(e) {
            if (e.target === this) fecharLogin();
        });

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') fecharLogin();
        });

        // ==========================================
        // AUTENTICAÇÃO BIOMÉTRICA (Face ID / Touch ID)
        // ==========================================
        
        var BIOMETRIC_KEY = 'zara_biometric_enabled';
        var BIOMETRIC_CREDENTIAL = 'zara_biometric_credential';
        
        // Verifica se WebAuthn está disponível
        function biometriaDisponivel() {
            return window.PublicKeyCredential !== undefined && 
                   typeof window.PublicKeyCredential === 'function';
        }
        
        // Verifica se o dispositivo suporta autenticação de plataforma (Face ID, Touch ID)
        async function verificarSuporteBiometria() {
            if (!biometriaDisponivel()) return false;
            
            try {
                const available = await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable();
                return available;
            } catch (e) {
                console.log('Biometria não suportada:', e);
                return false;
            }
        }
        
        // Inicializa interface de biometria
        async function inicializarBiometria() {
            const suportado = await verificarSuporteBiometria();
            const configurado = localStorage.getItem(BIOMETRIC_KEY) === 'true';
            
            const btnBiometric = document.getElementById('biometricBtn');
            const divider = document.getElementById('loginDivider');
            const setupLink = document.getElementById('setupBiometricLink');
            
            if (suportado) {
                if (configurado) {
                    // Mostrar botão de Face ID
                    btnBiometric.style.display = 'flex';
                    divider.style.display = 'flex';
                    setupLink.style.display = 'none';
                } else {
                    // Mostrar link para configurar
                    btnBiometric.style.display = 'none';
                    divider.style.display = 'none';
                    setupLink.style.display = 'block';
                }
            }
        }
        
        // Gera um ID único para o usuário
        function gerarUserId() {
            let id = localStorage.getItem('zara_user_id');
            if (!id) {
                id = 'zara_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('zara_user_id', id);
            }
            return id;
        }
        
        // Converte string para ArrayBuffer
        function stringToBuffer(str) {
            return Uint8Array.from(str, c => c.charCodeAt(0));
        }
        
        // Converte ArrayBuffer para Base64
        function bufferToBase64(buffer) {
            return btoa(String.fromCharCode(...new Uint8Array(buffer)));
        }
        
        // Configura biometria pela primeira vez
        async function configurarBiometria() {
            if (!biometriaDisponivel()) {
                toast('Seu navegador nao suporta biometria');
                return;
            }
            
            try {
                const userId = gerarUserId();
                
                // Opções para criar credencial
                const createOptions = {
                    publicKey: {
                        challenge: stringToBuffer('zara_challenge_' + Date.now()),
                        rp: {
                            name: 'ZARA Private Access',
                            id: window.location.hostname
                        },
                        user: {
                            id: stringToBuffer(userId),
                            name: 'master@zara.local',
                            displayName: 'ZARA Master'
                        },
                        pubKeyCredParams: [
                            { type: 'public-key', alg: -7 },  // ES256
                            { type: 'public-key', alg: -257 } // RS256
                        ],
                        authenticatorSelection: {
                            authenticatorAttachment: 'platform',
                            userVerification: 'required',
                            residentKey: 'preferred'
                        },
                        timeout: 60000,
                        attestation: 'none'
                    }
                };
                
                // Criar credencial
                const credential = await navigator.credentials.create(createOptions);
                
                if (credential) {
                    // Salvar ID da credencial
                    localStorage.setItem(BIOMETRIC_CREDENTIAL, bufferToBase64(credential.rawId));
                    localStorage.setItem(BIOMETRIC_KEY, 'true');
                    
                    toast('Face ID configurado com sucesso!');
                    inicializarBiometria();
                }
            } catch (e) {
                console.error('Erro ao configurar biometria:', e);
                if (e.name === 'NotAllowedError') {
                    toast('Permissao negada. Tente novamente.');
                } else {
                    toast('Erro ao configurar. Tente novamente.');
                }
            }
        }
        
        // Autenticar com biometria
        async function autenticarBiometria() {
            if (!biometriaDisponivel()) {
                toast('Biometria nao disponivel');
                return;
            }
            
            const credentialId = localStorage.getItem(BIOMETRIC_CREDENTIAL);
            if (!credentialId) {
                toast('Configure a biometria primeiro');
                return;
            }
            
            try {
                // Converter credencial salva de volta para ArrayBuffer
                const credentialIdBuffer = Uint8Array.from(atob(credentialId), c => c.charCodeAt(0));
                
                const getOptions = {
                    publicKey: {
                        challenge: stringToBuffer('zara_auth_' + Date.now()),
                        rpId: window.location.hostname,
                        allowCredentials: [{
                            type: 'public-key',
                            id: credentialIdBuffer,
                            transports: ['internal']
                        }],
                        userVerification: 'required',
                        timeout: 60000
                    }
                };
                
                // Solicitar autenticação
                const assertion = await navigator.credentials.get(getOptions);
                
                if (assertion) {
                    // Autenticação bem-sucedida
                    sessionStorage.setItem(AUTH_KEY, 'true');
                    fecharLogin();
                    desbloquearConteudo();
                    toast('Acesso autorizado via Face ID');
                }
            } catch (e) {
                console.error('Erro na autenticacao biometrica:', e);
                if (e.name === 'NotAllowedError') {
                    toast('Autenticacao cancelada');
                } else {
                    toast('Falha na autenticacao. Use senha.');
                }
            }
        }
        
        // Auto-login com biometria ao abrir modal
        function abrirLoginComBiometria() {
            const configurado = localStorage.getItem(BIOMETRIC_KEY) === 'true';
            if (configurado) {
                // Tentar autenticar automaticamente
                setTimeout(() => autenticarBiometria(), 300);
            }
        }
        
        // Inicializar
        verificarSessao();
        inicializarBiometria();
    </script>
</body>
</html>
